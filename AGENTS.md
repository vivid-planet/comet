# Agent Instructions

## Linting

- When making changes in a package, run `pnpm run lint:eslint --fix` in that package folder to autoformat with ESLint before finalizing changes.

## Demo application

- Start the full demo (admin, API, site):
  ```bash
  pnpm exec dev-pm start @demo
  ```
  or
  ```bash
  pnpm run dev:demo
  ```
- Start individual demo services:
  ```bash
  pnpm exec dev-pm start @demo-api @demo-admin @demo-site
  ```

## Rebuilding packages

- Build all Comet packages:
  ```bash
  pnpm run build:packages
  ```
- Build only the packages you changed (repeat the filter as needed):
  ```bash
  pnpm --recursive --filter '<package-name>' run build
  ```

## Changesets and changelog

- We use Changesets for tracking changes. Create a non-empty changeset file when making relevant user-facing/package changes (not for docs-only or internal-only updates).
- `CHANGELOG.md` is autogenerated; do not edit it manually.

### When to create a changeset

Create a changeset when:
- Fixing a bug that affects package users
- Adding new features or functionality
- Making breaking changes
- Modifying public APIs or behavior

Do NOT create a changeset for:
- Documentation-only changes
- Internal refactoring with no user-facing impact
- Changes only to demo applications or tests
- Formatting or linting fixes

### How to create a changeset

1. Create a new markdown file in `.changeset/` directory with a descriptive kebab-case name (e.g., `fix-scheduled-campaign-past-date.md`)

2. Add YAML frontmatter with the affected package(s) and version bump type:
   ```markdown
   ---
   "@comet/package-name": patch
   ---
   ```

3. Version bump types:
   - `patch` - Bug fixes and minor improvements (0.0.X)
   - `minor` - New features, non-breaking changes (0.X.0)
   - `major` - Breaking changes (X.0.0)

4. Write a clear description of the change below the frontmatter. Include:
   - What problem was fixed or what feature was added
   - Key implementation details if relevant
   - Any breaking changes or migration steps (for major versions)

5. For changes affecting multiple packages, list each package in the frontmatter:
   ```markdown
   ---
   "@comet/admin": minor
   "@comet/cms-admin": minor
   ---
   ```

Example changeset:
```markdown
---
"@comet/brevo-api": patch
---

Fix email campaigns getting stuck in broken state when scheduled in the past

- Replace `@MinDate(new Date())` with `@MinDate(() => new Date())`
- Check actual campaign status before blocking updates
```


## Commit messages

- Do not use Conventional Commits.
- If a change is scoped to one package, prefix the commit message with the affected package name.

## Generated demo files

- `demo/api` and `demo/admin` contain `generated/` folders. Do not edit files inside `generated/` directly; rerun `api-generator` or `admin-generator` to update them.
