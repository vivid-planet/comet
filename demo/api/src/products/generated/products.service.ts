// This file has been generated by comet api-generator.
// You may choose to use this file as scaffold by moving this file out of generated folder and removing this comment.
import { filtersToMikroOrmQuery, searchToMikroOrmQuery } from "@comet/cms-api";
import { ObjectQuery } from "@mikro-orm/core";
import { Injectable } from "@nestjs/common";

import { Product } from "../entities/product.entity";
import { ProductFilter } from "./dto/product.filter";

@Injectable()
export class ProductsService {
    getFindCondition(options: { search?: string; filter?: ProductFilter }): ObjectQuery<Product> {
        const andFilters = [];

        if (options.search) {
            andFilters.push(
                searchToMikroOrmQuery(options.search, [
                    "title",
                    "slug",
                    "description",
                    "type",
                    "category.title",
                    "category.slug",
                    "manufacturer.name",
                    "manufacturer.addressAsEmbeddable_street",
                    "manufacturer.addressAsEmbeddable_country",
                    "manufacturer.addressAsEmbeddable_alternativeAddress_street",
                    "manufacturer.addressAsEmbeddable_alternativeAddress_country",
                ]),
            );
        }

        if (options.filter) {
            andFilters.push(filtersToMikroOrmQuery(options.filter));
        }

        return andFilters.length > 0 ? { $and: andFilters } : {};
    }
}
